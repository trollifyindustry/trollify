<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Master Data</title>

<style>
/* RESET */
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
}

/* BODY */
body{
  font-family:'Segoe UI', Arial, sans-serif;
  background:linear-gradient(135deg,#ffffff,#f3e8ff);
  text-align:center;
  padding:15px;
  color:#4a148c;
}

/* HEADING */
h2{
  color:#6a1b9a;
  margin-bottom:20px;
  font-size:22px;
}

/* SEARCH INPUTS */
input{
  padding:10px;
  margin:6px;
  border-radius:25px;
  border:2px solid #e1bee7;
  outline:none;
  font-size:14px;
  transition:0.3s;
  width:100%;
  max-width:220px;
  color:#4a148c;
}

input:focus{
  border-color:#8e24aa;
  box-shadow:0 0 8px rgba(142,36,170,0.3);
}

/* TABLE WRAPPER FOR MOBILE */
table{
  width:100%;
  margin:auto;
  border-collapse:collapse;
  background:#ffffff;
  border-radius:15px;
  overflow:hidden;
  box-shadow:0 6px 20px rgba(106,27,154,0.15);
  font-size:14px;
}

/* TABLE HEAD */
th{
  background:#8e24aa;
  color:white;
  padding:12px;
  font-weight:600;
}

/* TABLE DATA */
td{
  padding:10px;
  border-bottom:1px solid #f3e5f5;
}

tr:hover{
  background:#f9f1ff;
  transition:0.3s;
}

/* BUTTON */
button{
  padding:6px 12px;
  background:#ab47bc;
  color:white;
  border:none;
  border-radius:20px;
  cursor:pointer;
  font-size:13px;
  transition:0.3s;
}

button:hover{
  background:#6a1b9a;
  transform:scale(1.05);
}

/* PHOTO */
img{
  width:55px;
  height:55px;
  object-fit:cover;
  border-radius:10px;
  border:2px solid #ce93d8;
}

/* MOBILE RESPONSIVE */
@media screen and (max-width:768px){

  body{
    padding:10px;
  }

  h2{
    font-size:18px;
  }

  input{
    max-width:100%;
    font-size:13px;
    padding:9px;
  }

  table{
    display:block;
    overflow-x:auto;   /* Horizontal scroll fix */
    white-space:nowrap;
    font-size:12px;
  }

  th, td{
    padding:8px;
  }

  button{
    font-size:11px;
    padding:5px 8px;
  }

  img{
    width:45px;
    height:45px;
  }

}
</style>
</head>

<body>

<h2>Master Student Data</h2>

<input type="text" id="searchName" placeholder="Search Name">
<input type="text" id="searchRoll" placeholder="Search Roll">
<input type="text" id="searchClass" placeholder="Search Class">
<input type="text" id="searchFather" placeholder="Search Father">

<br><br>

<table>
<thead>
<tr>
<th>Sr No</th>
<th>Roll</th>
<th>Name</th>
<th>Father</th>
<th>Class</th>
<th>Photo URL</th>
<th>Photo</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<script>


const API_URL = "https://script.google.com/macros/s/AKfycbxWK4aMq-3lGGh_0HrsbIlQTGYFwbXlRjHtNjOdYBsKCZVVk76m1EpOhhvD7CWiC_Pj/exec?action=getMasterData";

let masterData = [];

// ======================
// LOAD DATA (Local + Server Sync)
// ======================
async function loadData(){

  // 1️⃣ Load from localStorage first
  const localData = localStorage.getItem("masterData");

  if(localData){
    masterData = JSON.parse(localData);
    renderTable(masterData);
  }

  // 2️⃣ Fetch fresh data in background
  try{
    const res = await fetch(API_URL);
    const newData = await res.json();

    // 3️⃣ Newest data upar lane ke liye reverse
    newData.reverse();

    // 4️⃣ Compare old vs new
    if(JSON.stringify(newData) !== JSON.stringify(masterData)){

      masterData = newData;

      localStorage.setItem(
        "masterData",
        JSON.stringify(newData)
      );

      renderTable(masterData);

      console.log("Table Updated from Server");
    }

  }catch(error){
    console.log("Background update failed");
  }

}


// ======================
// RENDER TABLE
// ======================
function renderTable(data){

  const tbody = document.getElementById("tableBody");
  tbody.innerHTML = "";

  data.forEach(student => {

    const row = `
    <tr>
      <td>${student.srNo}</td>
      <td>${student.roll}</td>
      <td>${student.studentName}</td>
      <td>${student.father}</td>
      <td>${student.studentClass}</td>
      <td>
        ${
          student.photoUrl 
          ? `<button onclick="copyUrl('${student.photoUrl}')">Copy</button>`
          : "No URL"
        }
      </td>
      <td>
        ${
          student.photoUrl 
          ? `<img src="${student.photoUrl}">` 
          : "No Photo"
        }
      </td>
    </tr>
    `;

    tbody.innerHTML += row;

  });

}
// ======================
// COPY FUNCTION (Modern)
// ======================
function copyUrl(url){

  navigator.clipboard.writeText(url)
  .then(()=>{
    alert("URL Copied!");
  })
  .catch(()=>{
    alert("Copy Failed!");
  });

}


// ======================
// SEARCH FILTER
// ======================
document.querySelectorAll("input").forEach(input=>{
  input.addEventListener("keyup", filterData);
});

function filterData(){

  const name = document.getElementById("searchName").value.toLowerCase();
  const roll = document.getElementById("searchRoll").value.toLowerCase();
  const cls = document.getElementById("searchClass").value.toLowerCase();
  const father = document.getElementById("searchFather").value.toLowerCase();

  const filtered = masterData.filter(student => {

    return (
      student.studentName.toLowerCase().includes(name) &&
      student.roll.toString().toLowerCase().includes(roll) &&
      student.studentClass.toLowerCase().includes(cls) &&
      student.father.toLowerCase().includes(father)
    );

  });

  renderTable(filtered);
}


// ======================
// INITIAL LOAD
// ======================
loadData();

// ======================
// AUTO UPDATE EVERY 5 SEC
// ======================
setInterval(loadData, 5000);

</script>

</body>
</html>


<!---


const SHEET_ID = "1qmN4OE3u174RHsiuS0rq20jaQH5ufQkrBjHD5rS9ejw";
const SHEET_NAME = "Sheet2";

function doGet(e) {

  const action = e.parameter.action;

  if (action === "getMasterData") {
    return ContentService
      .createTextOutput(JSON.stringify(getMasterData()))
      .setMimeType(ContentService.MimeType.JSON);
  }

  return ContentService
    .createTextOutput(JSON.stringify({ status: "invalid" }))
    .setMimeType(ContentService.MimeType.JSON);
}

function getMasterData() {

  const sheet = SpreadsheetApp
    .openById(SHEET_ID)
    .getSheetByName(SHEET_NAME);

  const data = sheet.getDataRange().getValues();
  data.shift(); // remove header

  return data.map((row, index) => ({

    srNo: index + 1,
    roll: row[1],
    studentName: row[2],
    studentClass: row[5],
    father: row[6],
    photoUrl: row[8] || ""

  }));
} --->
